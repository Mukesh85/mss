angular.module("mss_app").controller("editController",["$scope","$location","$routeParams",function(e,t,a){$(".navbar .nav li").removeClass("active"),e.hasParams=!0;var o=a.day,r=a.month,s=a.year,n=function(e){for(var t=e,a=0;a<e.length;a++)"+"==e.charAt(a)&&(t=t.substring(0,a)+" "+t.substring(a+1));return t}(a.presenter.toLowerCase()),i=r+"/"+o+"/"+s,l=JSON.parse(localStorage.getItem("datejson")),c=JSON.parse(localStorage.getItem("presenterjson"));e.check=!1,e.details={},console.log(i),l.hasOwnProperty(i)?(e.check=!0,l[i].forEach(function(t){t.presenter.toLowerCase()==n.toLowerCase()&&(e.check=!1,e.details=t)})):e.check=!0,setTimeout(function(){$("#datepickerevent").datetimepicker({defaultDate:new Date(e.details.date),daysOfWeekDisabled:[0,2,3,4,5,6]})},3),e.submitForm=function(){var a=new Date($("#date").val()),o=a.toLocaleDateString();e.details.date=a;var r=e.details.presenter.toLowerCase();if(o==i&&r==n)l[i].forEach(function(t){t.presenter.toLowerCase()==n&&(t=e.details)}),c[n].forEach(function(t){new Date(t.date).toLocaleDateString()==o&&(t.topic=e.details.topic,t.date=e.details.date)});else if(o==i&&r!=n){l[i].forEach(function(t){t.presenter.toLowerCase()==n&&(t=e.details)});var s=0;1==c[n].length?delete c[n]:c[n].forEach(function(e){new Date(e.date).toLocaleDateString()==i&&c[n].splice(s,1),s++}),(d={}).topic=e.details.topic,d.date=e.details.date,c.hasOwnProperty(r.toLowerCase())?c[r.toLowerCase()].push(d):(c[r.toLowerCase()]=[],c[r.toLowerCase()].push(d))}else if(o!=i&&r==n){c[n].forEach(function(t){new Date(t.date).toLocaleDateString()==i&&(t.topic=e.details.topic,t.date=e.details.date)});s=0;1==l[i].length?delete l[i]:l[i].forEach(function(e){e.presenter.toLowerCase()==n&&l[i].splice(s,1),s++}),l.hasOwnProperty(o)?l[o].push(e.details):(l[o]=[],l[o].push(e.details))}else{if(1==l[i].length)delete l[i];else{s=0;l[i].forEach(function(e){e.presenter.toLowerCase()==n&&l[i].splice(s,1),s++})}if(l.hasOwnProperty(o)?l[o].push(e.details):(l[o]=[],l[o].push(e.details)),1==c[n].length)delete c[n];else{s=0;c[n].forEach(function(e){new Date(e.date).toLocaleDateString()==i&&c[n].splice(s,1),s++})}var d;(d={}).topic=e.details.topic,d.date=e.details.date,c.hasOwnProperty(r.toLowerCase())?c[r.toLowerCase()].push(d):(c[r.toLowerCase()]=[],c[r.toLowerCase()].push(d))}i=o,n=r,localStorage.setItem("datejson",JSON.stringify(l)),localStorage.setItem("presenterjson",JSON.stringify(c)),t.path("/view/"+function(e){for(var t=e,a=0;a<e.length;a++)" "==e.charAt(a)&&(t=t.substring(0,a)+"+"+t.substring(a+1));return t}(r)+"/"+o)}}]);